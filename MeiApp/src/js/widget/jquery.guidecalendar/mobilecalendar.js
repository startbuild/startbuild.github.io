!function(t){var e,s,a=0,n=[],i=!1,d=function(t){return s=t%4!=0||t%100==0&&t%400!=0?0:1};Array.prototype.contains=function(t){for(var e=this.length;e--;)if(this[e]===t)return!0;return!1},Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in e)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[s]:("00"+e[s]).substr((""+e[s]).length)));return t};var l=function(t,e){var s=new Date(Date.parse(t.replace(/-/g,"/"))).getTime(),a=new Date(Date.parse(e.replace(/-/g,"/"))).getTime(),n=Math.abs(s-a)/864e5;return n},r=function(s){this.settings={source:null,startdate:null,enddate:null,weekend:null,startDate:null,endDate:null,mouthPage:4,daysDisabled:null,datetdCellClick:null,errFun:null},this.cheader="<table class='pCalendar'><tr class='cheader'><td class='theader'>周日</td><td class='theader'>周一</td><td class='theader'>周二</td><td class='theader'>周三</td><td class='theader'>周四</td><td class='theader'>周五</td><td class='theader'>周六</td></tr>",this.settings=t.extend(this.settings,s),e=this.settings,this.Init()};r.prototype={Init:function(){this.ctoday=new Date,this.cyear=this.ctoday.getFullYear(),this.daysNumPerMonth=new Array(31,28+d(this.cyear),31,30,31,30,31,31,30,31,30,31),this.cmonth=this.ctoday.getMonth(),this.tempMonth=this.cmonth,t(this.settings.source).html("");for(var e=0;e<this.settings.mouthPage;e++)this.drawCalendar(this.tempMonth++);this.bindEvent(this.settings.datetdCellClick)},BindPrice:function(){},addMonth:function(){this.drawCalendar(this.tempMonth++),this.bindEvent(this.settings.datetdCellClick)},PrevMonth:function(){this.cmonth--,0==this.cmonth&&(this.cmonth=12,this.cyear--)},drawCalendar:function(e){var s=this.cyear;e>11&&(s+=Math.floor(e/12),e%=12),this.daysNumPerMonth[1]=28+d(s);var a=null,n=null,i=[];if(null!=this.settings.startdate&&(a=new Date(this.settings.startdate.replace(/-/g,"/"))),null!=this.settings.enddate&&(n=new Date(this.settings.enddate.replace(/-/g,"/"))),null!=this.settings.daysDisabled&&""!=this.settings.daysDisabled)for(var l=0;l<this.settings.daysDisabled.length;l++)i.push(this.settings.daysDisabled[l]);if(!(null!=n&&new Date(s+"/"+(e+1)+"/01")>n)){for(var r,h,c=this.ctoday.getDate(),o=new Date(s,e,1),u=o.getDay(),g=this.daysNumPerMonth[e],f=Math.ceil((g+u)/7),v="",p=0;p<f;p++){v+="<tr>";for(var y=0;y<7;y++){r=7*p+y,h=r-u+1,h=h<=0||h>g?"":r-u+1;var D="",m="";if(""!=h){D=s+"-"+(e+1)+"-"+h,m="datetdCell ";var M=new Date(D.replace(/-/g,"/"));""!=D&&(D=new Date(D.replace(/-/g,"/")).format("yyyy-MM-dd")),(null!=a&&M<a||null!=n&&M>n||null!=this.settings.weekend&&this.settings.weekend.indexOf(y)>=0||i.contains(D))&&(m+="disabledtd ")}else m="emptyCell ";v+=h==c&&e==this.cmonth&&s==this.cyear?"<td align='center' data-value='"+D+"' class='ctoday "+m+"'><div>"+h+"</div></td>":"<td align='center' data-value='"+D+"' class='"+m+"'><div>"+h+"</div></td>"}v+="</tr>"}v+="</table>";var w="<div class='Time-Div'>"+s+"年"+(e+1)+"月</div>";t(this.settings.source).append(w+this.cheader+v)}},bindEvent:function(e){var s,d,r=this.settings.errFun;t(this.settings.source).find("td").unbind("click").click(function(){a++;var h="",c=t(this),o=c.attr("class");if(!(o.indexOf("theader")>=0||""==c.attr("data-value")||o.indexOf("disabledtd")>=0)){if(h=t(this).attr("data-value"),1==a&&(s=c,i=!1,t(".selected").removeClass("selected"),c.addClass("selected"),n.push(h)),2==a)if(d=c,new Date(h)<new Date(n[0]))t(".selected").removeClass("selected"),c.addClass("selected"),s=c,i=!1,a=1,n=[],n.push(h);else{for(var u=l(n[0],h),g=0;g<u;g++){s=s.next();var f=s.length>0?s.attr("data-value"):"";if(s&&""!=f){if(s.hasClass("disabledtd"))return i=!0,a=0,void(n=[])}else if(d=d.prev(),d.hasClass("disabledtd"))return i=!0,a=0,void(n=[])}i||(c.addClass("selected"),n.push(h),a=0,null!=e&&(setTimeout(e(n),1e3),n=[]))}i&&null!=r&&r()}}),t("#pmonth").click(function(){this.PrevMonth()}),t("#nmonth").click(function(){this.NextMonth()})},getSelectValue:function(){return t(this.settings.source).find(".selected").attr("data-value")},setStartDate:function(t){this.settings.startdate=t,this.Init()},setEndDate:function(t){this.settings.enddate=t,this.Init()},setDaysOfWeekDisabled:function(t){this.settings.weekend=t,this.Init()}},t.fn.extend({InitDailyPriceCalendar:function(e){e||(e={}),e.source=t(this);var s=new r(e);return s}})}(jQuery);