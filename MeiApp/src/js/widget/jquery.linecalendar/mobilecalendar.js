!function(t){var e,s,i=function(t){return s=t%4!=0||t%100==0&&t%400!=0?0:1};Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in e)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[s]:("00"+e[s]).substr((""+e[s]).length)));return t};var n=function(s){this.settings={source:null,startdate:null,enddate:null,weekend:null,pageIndex:1,pageSize:3,calPrices:null,datetdCellClick:null},this.cheader="<table class='pCalendar'><tr class='cheader'><td class='theader'>周日</td><td class='theader'>周一</td><td class='theader'>周二</td><td class='theader'>周三</td><td class='theader'>周四</td><td class='theader'>周五</td><td class='theader'>周六</td></tr>",this.settings=t.extend(this.settings,s),e=this.settings,this.Init()};n.prototype={Init:function(){this.ctoday=new Date,this.cyear=this.ctoday.getFullYear(),this.daysNumPerMonth=new Array(31,28+i(this.cyear),31,30,31,30,31,31,30,31,30,31),this.cmonth=this.ctoday.getMonth(),this.tempMonth=this.cmonth,t(this.settings.source).html("");for(var e=this.settings.pageIndex-1;e<this.settings.pageSize;e++)this.drawCalendar(this.tempMonth++);this.bindEvent()},BindPrice:function(){},addMonth:function(){this.drawCalendar(this.tempMonth++),this.bindEvent()},PrevMonth:function(){this.cmonth--,0==this.cmonth&&(this.cmonth=12,this.cyear--)},nextPage:function(t,e,s){this.settings.calPrices=t;for(var i=(e-1)*s;i<e*s;i++)this.drawCalendar(this.tempMonth++);this.bindEvent()},setPrice:function(t){this.settings.calPrices=t,this.Init()},getPrice:function(e,s){var i="";return""==e?i:(t.each(s,function(t,s){if(s.calendar==e)return i=s.price,!1}),i)},drawCalendar:function(e){var s=this.cyear;e>11&&(s+=Math.floor(e/12),e%=12),this.daysNumPerMonth[1]=28+i(s);var n=null,a=null;if(null!=this.settings.startdate&&(n=new Date(this.settings.startdate.replace(/-/g,"/"))),null!=this.settings.enddate&&(a=new Date(this.settings.enddate.replace(/-/g,"/"))),!(null!=a&&new Date(s+"/"+(e+1)+"/01")>a)){for(var d,r,l=this.ctoday.getDate(),h=new Date(s,e,1),c=h.getDay(),o=this.daysNumPerMonth[e],u=Math.ceil((o+c)/7),g="",f="",v=0;v<u;v++){g+="<tr>";for(var p=0;p<7;p++){d=7*v+p,r=d-c+1,r=r<=0||r>o?"":d-c+1;var y="",m="";if(""!=r){y=s+"-"+(e+1)+"-"+r,m="datetdCell ";var M=new Date(y.replace(/-/g,"/"));(null!=n&&M<n||null!=a&&M>a||null!=this.settings.weekend&&this.settings.weekend.indexOf(p)>=0)&&(m+="disabledtd ")}else m="emptyCell ";if(y=""==y?"":new Date(y.replace(/-/g,"/")).format("yyyy-MM-dd"),null!=this.settings.calPrices&&this.settings.calPrices.length>0){var w=this.getPrice(y,this.settings.calPrices);f=""===w?"":"&yen;"+w,""===w&&(m="disabledtd")}g+=r==l&&e==this.cmonth&&s==this.cyear?"<td align='center' data-value='"+y+"' class='ctoday "+m+"'><div class='days'>"+r+"</div><div class='price'>"+f+"</div></td>":"<td align='center' data-value='"+y+"' class='"+m+"'><div class='days'>"+r+"</div><div class='price'>"+f+"</div></td>"}g+="</tr>"}g+="</table>";var D="<div class='Time-Div'>"+s+"年"+(e+1)+"月</div>";t(this.settings.source).append(D+this.cheader+g)}},bindEvent:function(){t(this.settings.source).find("td").unbind("click").click(function(){var s=t(this),i=s.attr("class");if(!(i.indexOf("theader")>=0||""==s.attr("data-value")||i.indexOf("disabledtd")>=0)){t(".selected").removeClass("selected"),s.addClass("selected");var n=s.attr("data-value");null!=e.datetdCellClick&&e.datetdCellClick(n)}}),t("#pmonth").click(function(){this.PrevMonth()}),t("#nmonth").click(function(){this.NextMonth()})},getSelectValue:function(){return t(this.settings.source).find(".selected").attr("data-value")},setStartDate:function(t){this.settings.startdate=t,this.Init()},setEndDate:function(t){this.settings.enddate=t,this.Init()},setDaysOfWeekDisabled:function(t){this.settings.weekend=t,this.Init()}},t.fn.extend({InitDailyPriceCalendar:function(e){e||(e={}),e.source=t(this);var s=new n(e);return s}})}(jQuery);