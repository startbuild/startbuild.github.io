!function(t){var e,s,n=function(t){return s=t%4!=0||t%100==0&&t%400!=0?0:1};Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in e)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[s]:("00"+e[s]).substr((""+e[s]).length)));return t};var a=function(s){this.settings={source:null,startdate:null,enddate:null,weekend:null,datetdCellClick:null},this.cheader="<table class='pCalendar'><tr class='cheader'><td class='theader'>周日</td><td class='theader'>周一</td><td class='theader'>周二</td><td class='theader'>周三</td><td class='theader'>周四</td><td class='theader'>周五</td><td class='theader'>周六</td></tr>",this.settings=t.extend(this.settings,s),e=this.settings,this.Init()};a.prototype={Init:function(){this.ctoday=new Date,this.cyear=this.ctoday.getFullYear(),this.daysNumPerMonth=new Array(31,28+n(this.cyear),31,30,31,30,31,31,30,31,30,31),this.cmonth=this.ctoday.getMonth(),this.tempMonth=this.cmonth,t(this.settings.source).html(""),this.drawCalendar(this.tempMonth),this.drawCalendar(++this.tempMonth),this.drawCalendar(++this.tempMonth),this.drawCalendar(++this.tempMonth),this.bindEvent()},BindPrice:function(){},addMonth:function(){this.drawCalendar(++this.tempMonth),this.bindEvent()},PrevMonth:function(){this.cmonth--,0==this.cmonth&&(this.cmonth=12,this.cyear--)},drawCalendar:function(e){var s=this.cyear;e>11&&(s+=Math.floor(e/12),e%=12),this.daysNumPerMonth[1]=28+n(s);var a=null,i=null;if(null!=this.settings.startdate&&(a=new Date(this.settings.startdate.replace(/-/g,"/"))),null!=this.settings.enddate&&(i=new Date(this.settings.enddate.replace(/-/g,"/"))),!(null!=i&&new Date(s+"/"+(e+1)+"/01")>i)){for(var d,h,l=this.ctoday.getDate(),r=new Date(s,e,1),c=r.getDay(),o=this.daysNumPerMonth[e],u=Math.ceil((o+c)/7),g="",f=0;f<u;f++){g+="<tr>";for(var v=0;v<7;v++){d=7*f+v,h=d-c+1,h=h<=0||h>o?"":d-c+1;var p="",y="";if(""!=h){p=s+"-"+(e+1)+"-"+h,y="datetdCell ";var m=new Date(p.replace(/-/g,"/"));(null!=a&&m<a||null!=i&&m>i||null!=this.settings.weekend&&this.settings.weekend.indexOf(v)>=0)&&(y+="disabledtd ")}else y="emptyCell ";p=""!=p?new Date(p.replace(/-/g,"/")).format("yyyy-MM-dd"):"",g+=h==l&&e==this.cmonth&&s==this.cyear?"<td align='center' data-value='"+p+"' class='ctoday "+y+"'><div>"+h+"</div></td>":"<td align='center' data-value='"+p+"' class='"+y+"'><div>"+h+"</div></td>"}g+="</tr>"}g+="</table>";var M="<div class='Time-Div'>"+s+"年"+(e+1)+"月</div>";t(this.settings.source).append(M+this.cheader+g)}},bindEvent:function(){t(this.settings.source).find("td").unbind("click").click(function(){var s=t(this),n=s.attr("class");if(!(n.indexOf("theader")>=0||""==s.attr("data-value")||n.indexOf("disabledtd")>=0)){t(".selected").removeClass("selected"),s.addClass("selected");var a=s.attr("data-value");null!=e.datetdCellClick&&e.datetdCellClick(a)}}),t("#pmonth").click(function(){this.PrevMonth()}),t("#nmonth").click(function(){this.NextMonth()})},getSelectValue:function(){return t(this.settings.source).find(".selected").attr("data-value")},setStartDate:function(t){this.settings.startdate=t,this.Init()},setEndDate:function(t){this.settings.enddate=t,this.Init()},setDaysOfWeekDisabled:function(t){this.settings.weekend=t,this.Init()}},t.fn.extend({InitDailyPriceCalendar:function(e){e||(e={}),e.source=t(this);var s=new a(e);return s}})}(jQuery);